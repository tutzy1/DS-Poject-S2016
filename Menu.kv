#:import Button kivy.uix.button.Button

<Menu>:
    path: ''
    index_select: ''
    query: ''
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'top'
        ScreenManager:
            size_hint: 1, .9
            id: _screen_manager
            Screen:
                name: 'MainScreen'
                BoxLayout:
                    orientation: 'vertical'
                    padding: 150, 50
                    spacing: 5
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Load documents to the index"
                            font_size: 25
                            on_press:
                                root.Update_Index()
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Get data about the index"
                            font_size: 25
                            on_press:
                                root.Doc_Count = str(root.Index.documentCount())
                                _screen_manager.current = 'IndexDetails'
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Go to the Ranker Environment"
                            font_size: 25
                            on_press: _screen_manager.current = 'Ranker'
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Get data about the queries database"
                            font_size: 25
                            on_press:
                                root.Queries_Count = str(len(root.Ranker_Environment.getQueriesMetadata('number')))
                                _screen_manager.current = 'QueriesDetails'

            Screen:
                name: 'LoadDocuments'
                FloatLayout:
                    orientation: 'vertical'
                    padding: 50
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: .5, .3
                        pos: 200,200
                        spacing: 5
                        Button:
                            text: "Create new index"
                            font_size: 30
                            on_press: _screen_manager.current = 'CreateNewIndex'
                        Button:
                            text: "Load to an exist index"
                            font_size: 30
                            on_press:
                                root.choose_index()
                                _screen_manager.current = 'LoadExistIndex'
            Screen:
                name: 'LoadExistIndex'
                FloatLayout:
                    orientation: 'vertical'
                    padding: 150, 50
                    AnchorLayout:
                        size_hint: .3, .15
                        anchor_x: 'center'
                        pos: 280,300
                        Button:
                            id: index_menu
                            text: 'Choose index'
                    AnchorLayout:
                        size_hint: .3, .15
                        anchor_x: 'center'
                        pos: 280,30
                        Button:
                            text: 'Submit'
                            on_press:
                                root.save_index_selection(index_menu.text)

            Screen:
                name: 'Ranker'
                BoxLayout:
                    orientation: 'vertical'
                    padding: 150, 50
                    spacing: 5
                    Label:
                        text: "[b]The Ranker Environment[/b]"
                        font_size: 50
                        markup: True
                        size_hint: 1, .3
                    AnchorLayout:
                        anchor_x: 'center'
                        anchor_y: 'bottom'
                        Button:
                            text: "Load queries to the database"
                            font_size: 25
                            size_hint: .8, .65
                            on_press:
                                root.Load_Queries()
                    AnchorLayout:
                        anchor_x: 'center'
                        anchor_y: 'center'
                        Button:
                            text: "Run the queries from the database"
                            font_size: 25
                            size_hint: .8, .65
                            on_press:
                                root.Get_Limit()
                                _screen_manager.current = 'RunQueriesMenu'
                    AnchorLayout:
                        anchor_x: 'center'
                        anchor_y: 'top'
                        Button:
                            height: '35dp'
                            text: "Run Query"
                            font_size: 25
                            size_hint: .8, .65
                            on_press:
                                _screen_manager.current = 'QueryInput'

            Screen:
                name: 'LoadQueries'
                FloatLayout:
                    orientation: 'vertical'
                    padding: 50
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: .9, 1
                        pos: 35,0
                        spacing: 10
                        Label:
                            text: "[b]Load Queries to the database[/b]"
                            font_size: 50
                            size_hint: 1, .2
                            markup: True
                        Label:
                            text: "Choose the source file please:"
                            font_size: 30
                            size_hint: 1, .15
                        FileChooserListView:
                            id: file2
                            size_hint: 1, 1
                            filters: ['*.xml']
                            file_encodings: ['utf-8', 'windows-1255']
                            multiselect: False
                            rootpath: "C:\Users\Tutzy\desktop"
                            on_selection: root.path = self.selection and self.selection[0] or ''
                        AnchorLayout:
                            size_hint: 1, .3
                            anchor_x: 'center'
                            Button:
                                text: 'Submit'
                                font_size: 35
                                size_hint: .3, .5
                                on_press:
                                    root.Load_Queries(root.path)
                                    _screen_manager.current = 'MainScreen'
            Screen:
                name: 'RunQueriesMenu'
                BoxLayout:
                    orientation: 'vertical'
                    padding: 150, 50
                    spacing: 5
                    Label:
                        text: "[b]Run queries from the database[/b]"
                        font_size: 30
                        markup: True
                        size_hint: 1, .2
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Show results on the screen"
                            font_size: 35
                            on_press:
                                sl.text = root.Ranker_Environment.runQueries(limit=root.limit)
                                _screen_manager.current = 'OutputScreen'
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Save results to file"
                            font_size: 30
                            on_press:
                                root.Run_Queries_File(root.limit)
                                _screen_manager.current = 'MainScreen'
            Screen:
                name: 'RunQueriesFile'
                FloatLayout:
                    orientation: 'vertical'
                    padding: 50
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: .9, 1
                        pos: 35,0
                        spacing: 10
                        Label:
                            text: "[b]Run queries - Save results to file[/b]"
                            font_size: 50
                            size_hint: 1, .2
                            markup: True
                        Label:
                            text: "Choose the directory to save the file:"
                            font_size: 30
                            size_hint: 1, .15
                        FileChooserListView:
                            id: file2
                            size_hint: 1, 1
                            file_encodings: ['utf-8', 'windows-1255']
                            multiselect: False
                            dirselect: True
                            rootpath: "C:\Users\Tutzy\desktop"
                            filters: [root.is_dir]
                            on_selection: root.path = self.selection and self.selection[0] or ''
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint: 1, .14
                            Label:
                                text: "Please enter a name for the new file:"
                                font_size: 20
                            TextInput:
                                id: FileName1
                                hint_text: "Name"
                                font_size: 20
                                multiline: False
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint: 1, .25
                            Label:
                                text: "How many documents would you like \nto appear in the result list?"
                                font_size: 20
                            TextInput:
                                id: Limit1
                                hint_text: "Insert limit... (insert 0 to unlimit)"
                                font_size: 20
                                input_filter: 'int'
                                multiline: False
                        AnchorLayout:
                            size_hint: 1, .3
                            anchor_x: 'center'
                            Button:
                                text: 'Submit'
                                font_size: 35
                                size_hint: .3, .5
                                on_press:
                                    root.Run_Queries_File(root.path, FileName1.text, Limit1.text)
                                    _screen_manager.current = 'MainScreen'
            Screen:
                name: 'RunQueryMenu'
                BoxLayout:
                    orientation: 'vertical'
                    padding: 150, 50
                    spacing: 5
                    Label:
                        text: "[b]Run query[/b]"
                        font_size: 40
                        markup: True
                        size_hint: 1, .2
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Show results on the screen"
                            font_size: 35
                            on_press:
                                sl.text = root.Ranker_Environment.runQuery(query=InputQuery.text, limit=root.limit)
                                _screen_manager.current = 'OutputScreen'
                    BoxLayout:
                        orientation: 'horizontal'
                        Button:
                            text: "Save results to file"
                            font_size: 30
                            on_press:
                                root.Run_Query_File(InputQuery.text, limit=root.limit)
                                _screen_manager.current = 'MainScreen'
            Screen:
                name: 'RunQueryFile'
                FloatLayout:
                    orientation: 'vertical'
                    padding: 50
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: .9, 1
                        pos: 35,0
                        spacing: 10
                        Label:
                            text: "[b]Run query - Save results to file[/b]"
                            font_size: 50
                            size_hint: 1, .2
                            markup: True
                        Label:
                            text: "Choose the directory to save the file:"
                            font_size: 30
                            size_hint: 1, .15
                        FileChooserListView:
                            id: file3
                            size_hint: 1, 1
                            file_encodings: ['utf-8', 'windows-1255']
                            multiselect: False
                            dirselect: True
                            filters: [root.is_dir]
                            on_selection: root.path = self.selection and self.selection[0] or ''
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint: 1, .14
                            Label:
                                text: "Please enter a name for the new file:"
                                font_size: 20
                            TextInput:
                                id: FileName2
                                hint_text: "Name"
                                font_size: 20
                                multiline: False
                        AnchorLayout:
                            size_hint: 1, .3
                            anchor_x: 'center'
                            Button:
                                text: 'Submit'
                                font_size: 35
                                size_hint: .3, .5
                                on_press:
                                    root.Run_Query_File(InputQuery.text, root.path, FileName2.text, Limit2.text)
                                    _screen_manager.current = 'MainScreen'

            Screen:
                name: 'QueryInput'
                FloatLayout:
                    orientation: 'vertical'
                    padding: 50
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: .9, .9
                        pos: 35,0
                        spacing: 15
                        Label:
                            text: "[b]Run Query[/b]"
                            font_size: 50
                            markup: True
                            size_hint: 1, .1
                        BoxLayout:
                            orientation: 'horizontal'
                            size_hint: 1, .4
                            Label:
                                text: "Please insert the query:"
                                font_size: 20
                            TextInput:
                                id: InputQuery
                                hint_text: "Query..."
                                font_size: 20
                                multiline: True
                        AnchorLayout:
                            size_hint: 1, .4
                            anchor_x: 'center'
                            Button:
                                text: 'Submit'
                                font_size: 35
                                size_hint: .3, .3
                                on_press:
                                    root.Get_Limit()
                                    _screen_manager.current = 'RunQueryMenu'
            Screen:
                name: 'OutputScreen'
                BoxLayout:
                    orientation: "vertical"
                    ScrollLabel:
                        id: sl
                        text: ''
                        font_size: sl_fontsize.value
                    BoxLayout:
                        size_hint_y: None
                        height: "48sp"
                        Label:
                            text: "Font size"
                            size_hint_x: None
                            width: self.texture_size[0] + dp(48)
                        Slider:
                            id: sl_fontsize
                            min: sp(8)
                            max: sp(100)
                            value: sp(14)
            Screen:
                __safe_id: [dropdown1.__self__]
                name: 'IndexDetails'
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'Get metadata of the index'
                        font_size: 40
                        size_hint: 1, .7
                    Label:
                        text: "The current number of document in the index: " + root.Doc_Count
                        font_size: 20
                        size_hint: 1, .7

                    Button:
                        id: btn
                        text: 'Choose the data to print'
                        on_release: dropdown1.open(self)
                        size_hint_y: None
                        height: '35dp'

                    Widget

                    DropDown:

                        id: dropdown1
                        on_parent: self.dismiss()
                        on_select: btn.text = args[1]
                        height: '40dp'

                        Button:
                            text: 'Print the ID\'s of all the documents in the index'
                            size_hint_y: None
                            height: '35dp'
                            on_release:
                                dropdown1.select(self.text)
                                sl2.halign = 'center'
                                sl2.text = root.PrintDocsIDs()

                        Button:
                            text: 'Print all the documents in the index'
                            size_hint_y: None
                            height: '35dp'
                            on_release:
                                dropdown1.select(self.text)
                                sl2.halign = 'left'
                                sl2.text = root.PrintDocs()

                    ScrollLabel:
                        id: sl2
                        size_hint: 1, 3.5
                        text: ''
                        font_size: sl2_fontsize.value
                    BoxLayout:
                        size_hint_y: None
                        height: "48sp"
                        Label:
                            text: "Font size"
                            size_hint_x: None
                            width: self.texture_size[0] + dp(48)
                        Slider:
                            id: sl2_fontsize
                            min: sp(8)
                            max: sp(100)
                            value: sp(14)
            Screen:
                __safe_id: [dropdown2.__self__]
                name: 'QueriesDetails'
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'Get metadata of the queries database'
                        font_size: 40
                        size_hint: 1, .7
                    Label:
                        text: "The current number of queries in the database: " + root.Queries_Count
                        font_size: 20
                        size_hint: 1, .7

                    Button:
                        id: btn2
                        text: 'Choose the data to print'
                        on_release: dropdown2.open(self)
                        size_hint_y: None
                        height: '35dp'

                    Widget

                    DropDown:

                        id: dropdown2
                        on_parent: self.dismiss()
                        on_select: btn2.text = args[1]
                        height: '40dp'

                        Button:
                            text: 'Print the ID\'s of all the queries in the database'
                            size_hint_y: None
                            height: '35dp'
                            on_release:
                                dropdown2.select(self.text)
                                sl3.halign = 'center'
                                sl3.text = root.PrintQueriesIDs()

                        Button:
                            text: 'Print all the queries in the database'
                            size_hint_y: None
                            height: '35dp'
                            on_release:
                                dropdown2.select(self.text)
                                sl3.halign = 'left'
                                sl3.text = root.PrintQueries()

                    ScrollLabel:
                        id: sl3
                        size_hint: 1, 3.5
                        text: ''
                        font_size: sl3_fontsize.value
                    BoxLayout:
                        size_hint_y: None
                        height: "48sp"
                        Label:
                            text: "Font size"
                            size_hint_x: None
                            width: self.texture_size[0] + dp(48)
                        Slider:
                            id: sl3_fontsize
                            min: sp(8)
                            max: sp(100)
                            value: sp(14)

            Screen:
                name: 'templeteScreen'
                Label:
                    text: 'templeteScreen'

    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'bottom'
        BoxLayout:
            orientation: 'horizontal'
            size_hint: .4, .1
            Button:
                text: 'Go to the main menu'
                font_size: 25
                on_press: _screen_manager.current = 'MainScreen'
